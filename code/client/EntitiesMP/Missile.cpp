/*
 * This file is generated by Entity Class Compiler, (c) CroTeam 1997-98
 */

#line 4 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"

#include "stdH.h"
#include <Engine/Math/Quaternion.h>
#include <Engine/Effect/CTag.h>
#include <Engine/Effect/CRefCountPtr.h>
#include <Engine/Effect/CEntityTag.h>
#include <Engine/Effect/CTagManager.h>
#include <Engine/Math/AdditionalFunction.h>
#include <Engine/Effect/CEffectGroup.h>

#include "EntitiesMP/Player.h"
#include "EntitiesMP/EnemyBase.h"
#include "EntitiesMP/CharacterBase.h"
#include <Engine/Entities/InternalClasses.h>
#include <Engine/Interface/UIManager.h>
#include <Engine/Effect/CSampleSpline.h>
#include <Engine/Effect/CMdlEffect.h>
#include <Engine/Entities/Skill.h>
#include <Engine/World/WorldRayCasting.h>
#include <Engine/Network/MessageDefine.h>
#include <Engine/Object/ActorMgr.h>
#include <EntitiesMP/Common/CharacterDefinition.h>
#include <Engine/Info/MyInfo.h>

typedef CSampleSpline< FLOAT3D, CCubicSplineInterpolate<FLOAT3D> > cubic_spline;
#define GetSpline() (*((cubic_spline*)m_pssPath))

// NOTE : 심하게 밀리는 싱글던젼...
#define	EXTREAM_SINGLEDUNGEON		(10)


#include <Missile.h>
#include <Missile_tables.h>
#line 51 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"

#include <Engine/Effect/CTag.h>
#include <Engine/Effect/CTagManager.h>
#include <Engine/Ska/ModelInstance.h>

void DamagedTargetsInRange(CEntity* pEntity, CSelectedEntities& dcEntities, enum DamageType dmtType, FLOAT fDamageAmmount, FLOAT3D vCenter, BOOL bSkill);

void ShotMissile(CEntity *penShoter, const char *szShotPosTagName
				 , CEntity *penTarget, FLOAT fMoveSpeed
				 , const char *szHitEffectName, const char *szArrowEffectName
				 , bool bCritical
				 , FLOAT fHorizonalOffset = 0.0f, FLOAT fVerticalOffset = 0.0f	//-1.0f ~ 1.0f
				 , INDEX iArrowType = 0, const char *szMissileModel = NULL, CSelectedEntities* dcEntities = NULL)		// iArrowType=0 : normal arrow, iArrowType=1 : magic arrow, iArrowType=etc : ??
{
	//입력 조건 검사.
	ASSERT(penShoter != NULL && penShoter->en_pmiModelInstance != NULL);
	ASSERT(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f);
	ASSERT(szShotPosTagName != NULL && szHitEffectName != NULL && szArrowEffectName != NULL);
	ASSERT(fHorizonalOffset <= 1.0f && fHorizonalOffset >= -1.0f);
	ASSERT(fVerticalOffset <= 1.0f && fVerticalOffset >= -1.0f);
	if(!(penShoter != NULL && penShoter->en_pmiModelInstance != NULL)) return;
	if(!(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f)) return;
	if(!(szShotPosTagName != NULL && szHitEffectName != NULL && szArrowEffectName != NULL)) return;

	//missile 생성.
	CTag *pTag = penShoter->en_pmiModelInstance->m_tmSkaTagManager.Find(szShotPosTagName);
	//if(pTag == NULL) pTag = penShoter->m_ptmTagManager->Find(szShotPosTagName);
	ASSERT(pTag != NULL);
	if(pTag == NULL) return;
	CPlacement3D plMissile;
	plMissile.pl_PositionVector = pTag->CurrentTagInfo().m_vPos;
	plMissile.pl_OrientationAngle = GetEulerAngleFromDir(penTarget->en_plPlacement.pl_PositionVector - penShoter->en_plPlacement.pl_PositionVector);
	CMissile *penMissile = (CMissile *)penShoter->en_pwoWorld->CreateEntity_t(plMissile, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_epSource = penShoter;
	penMissile->m_epTarget = penTarget;	//target entity
	penMissile->m_fMoveSpeed = fMoveSpeed;
	penMissile->m_fHorizonalOffset = fHorizonalOffset;
	penMissile->m_fVerticalOffset = fVerticalOffset;
	penMissile->m_strHitEffect = szHitEffectName;
	if(iArrowType == 0)
	{
		penMissile->m_eMissileType = MLT_NORMALARROW;
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\ArrowNormal.smc");	//Hardcoding
	}
	else if(iArrowType == 1 )
	{
		penMissile->m_eMissileType = MLT_SOMETHING;
		penMissile->m_fAfterDelay = 0.0f;
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\magic_arr.smc");	//Hardcoding
	}
	else if (iArrowType == 2)
	{
		penMissile->m_eMissileType = MLT_SOMETHING;
		penMissile->m_fAfterDelay = 0.0f;
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\invisible.smc");	//Hardcoding
	}
	else
	{
		penMissile->m_eMissileType = MLT_SOMETHING;
		penMissile->m_fAfterDelay = 0.0f;
		penMissile->m_fnModel = szMissileModel;
	}

	if (dcEntities != NULL)
	{
		for (int i=0 ; i<dcEntities->Count(); ++i)
		{
			penMissile->m_dcEnemies.Add(dcEntities->vectorSelectedEntities[i]);
		}
	}

	penMissile->m_bNoPeak = FALSE;
	penMissile->Initialize();
	
	penMissile->m_bNormalHit = TRUE;
	penMissile->m_bCritical = bCritical;
	penMissile->m_ulTargetID = penMissile->en_ulID;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szArrowEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());
	}
}

//orbit type
//-1 : nothing
//0 : Default(invisible)
//1 : Cutter
void ShotMagicContinued(CEntity *penShoter, FLOAT3D vStartPos, FLOATquat3D qStartRot
				 , CEntity *penTarget, FLOAT fMoveSpeed
				 , const char *szHitEffectName, const char *szMagicEffectName
				 , bool bCritical, INDEX iOrbitType, BOOL bDirectTag = FALSE)
{
	//입력 조건 검사.
	ASSERT(penShoter != NULL && penShoter->en_pmiModelInstance != NULL);
	ASSERT(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f);
	if(!(penShoter != NULL && penShoter->en_pmiModelInstance != NULL)) return;
	if(!(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f)) return;
	if(!(szHitEffectName != NULL && szMagicEffectName != NULL)) return;

	//missile 생성.
	CPlacement3D plMissile;
	plMissile.pl_PositionVector = vStartPos;
	plMissile.pl_OrientationAngle = GetEulerAngleFromQuaternion(qStartRot);
	//plMissile.pl_OrientationAngle = GetEulerAngleFromDir(penTarget->en_plPlacement.pl_PositionVector - penShoter->en_plPlacement.pl_PositionVector);
	CMissile *penMissile = (CMissile *)penShoter->en_pwoWorld->CreateEntity_t(plMissile, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_epSource = penShoter;
	penMissile->m_epTarget = penTarget;	//target entity
	penMissile->m_fMoveSpeed = fMoveSpeed;
	penMissile->m_strHitEffect = szHitEffectName;
	penMissile->m_eMissileType = MLT_SOMETHING;
	penMissile->m_bDirectTag = bDirectTag;
	penMissile->m_iFireObjectType = iOrbitType; // 스킬 오브젝트 타입
	if(iOrbitType == CSkill::MT_MAGECUTTER)
	{
		static FLOAT angleSpeed = 90.0f;
		penMissile->m_aAngleSpeed = angleSpeed;
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\mCutter.smc");	//Hardcoding
		penMissile->m_fAfterDelay = 0.0f;
	}
	else	//Default
	{
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\invisible.smc");	//Hardcoding
		penMissile->m_fAfterDelay = 0.0f;
	}

	penMissile->m_bNormalHit = FALSE;
	penMissile->m_fHorizonalOffset = 0;
	penMissile->m_fVerticalOffset = 0.15f;
	penMissile->m_bNoPeak = TRUE;

	penMissile->Initialize();

	if(iOrbitType == CSkill::MT_MAGECUTTER && penMissile->en_pmiModelInstance)
	{
		static FLOAT3D qRot(0,0,0);
		penMissile->en_pmiModelInstance->mi_qvOffset.qRot.FromEuler(qRot);
		penMissile->en_pmiModelInstance->mi_vStretch *= 0.35f; 
		penMissile->en_pmiModelInstance->mi_colModelColor = 0x828282FF;
		penMissile->en_pmiModelInstance->AddAnimation(
			penMissile->en_pmiModelInstance->FindFirstAnimationID(), AN_LOOPING|AN_CLEAR, 1, 0);
	}

	penMissile->m_ulTargetID = penMissile->en_ulID;
	penMissile->m_bCritical = bCritical;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szMagicEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());
	}
}

void ShotFallDown(FLOAT3D vStartPos, FLOAT3D vToTargetDir, FLOAT fMoveSpeed
				 , const char *szHitEffectName, const char *szFallObjEffectName
				 , bool bCritical)
{
	ASSERT(szHitEffectName != NULL && szFallObjEffectName != NULL);
	ASSERT(vToTargetDir.Length() > 0.99f && vToTargetDir.Length() < 1.01f);

	//Target 위치 계산 by ray cast
	FLOAT3D vTargetPos;
	FLOAT fMaxY = -9999999.0f;
	BOOL bFloorHitted = FALSE;
	FLOAT3D vSource = vStartPos;
	FLOAT3D vTarget = vStartPos - vToTargetDir * 100.0f;
	CCastRay crRay(NULL, vSource, vTarget);
	crRay.cr_ttHitModels = CCastRay::TT_NONE; // CCastRay::TT_FULLSEETHROUGH;
	crRay.cr_bHitTranslucentPortals = TRUE;
	crRay.cr_bPhysical = TRUE;
	CEntity *pen = CEntity::GetPlayerEntity(0);
	pen->GetWorld()->CastRay(crRay);
	if( (crRay.cr_penHit != NULL) && (crRay.cr_vHit(2) > fMaxY)) 
	{
		bFloorHitted = TRUE;
	}
	if(bFloorHitted)
	{
		vTargetPos = crRay.cr_vHit;
	}
	else
	{
		return;
	}
	
	//missile 생성.
	CPlacement3D plMissile;
	plMissile.pl_PositionVector = vStartPos;
	plMissile.pl_OrientationAngle = GetEulerAngleFromDir(vTargetPos - vStartPos);
	CMissile *penMissile = (CMissile *)pen->en_pwoWorld->CreateEntity_t(plMissile, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_fnModel = CTFileName("data\\effect\\ska\\invisible.smc");	//Hardcoding
	penMissile->m_bEntityTarget = FALSE;
	penMissile->m_vTargetPos = vTargetPos;
	penMissile->m_fMoveSpeed = fMoveSpeed;
	penMissile->m_strHitEffect = szHitEffectName;
	penMissile->m_eMissileType = MLT_FALLDOWN;
	penMissile->m_bNormalHit = FALSE;
	penMissile->m_fHorizonalOffset = 0;
	penMissile->m_fVerticalOffset = 0.15f;
	penMissile->m_bNoPeak = TRUE;
	penMissile->Initialize();

	penMissile->m_bCritical = bCritical;
	penMissile->m_ulTargetID = penMissile->en_ulID;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szFallObjEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());
	}
}

void ShotGoWaitBack(CEntity *penShoter, FLOAT3D vStartPos, FLOATquat3D qStartRot
				 , CEntity *penTarget, FLOAT fMoveSpeed, FLOAT fWaitTime
				 , const char *szHitEffectName, const char *szMoveEffectName
				 , bool bCritical
				 , FLOAT fHorizonalOffset = 0.0f, FLOAT fVerticalOffset = 0.0f	//-1.0f ~ 1.0f
				 )
{
	//입력 조건 검사.
	ASSERT(penShoter != NULL && penShoter->en_pmiModelInstance != NULL);
	ASSERT(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f);
	ASSERT(szHitEffectName != NULL && szMoveEffectName != NULL);
	ASSERT(fHorizonalOffset <= 1.0f && fHorizonalOffset >= -1.0f);
	ASSERT(fVerticalOffset <= 1.0f && fVerticalOffset >= -1.0f);
	if(!(penShoter != NULL && penShoter->en_pmiModelInstance != NULL)) return;
	if(!(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f)) return;
	if(!(szHitEffectName != NULL && szMoveEffectName != NULL)) return;

	//missile 생성.
	CPlacement3D plMissile;
	plMissile.pl_PositionVector = vStartPos;
	plMissile.pl_OrientationAngle = GetEulerAngleFromQuaternion(qStartRot);
	CMissile *penMissile = (CMissile *)penShoter->en_pwoWorld->CreateEntity_t(plMissile, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_epSource = penShoter;
	penMissile->m_epTarget = penTarget;	//target entity
	penMissile->m_fMoveSpeed = fMoveSpeed;
	penMissile->m_fHorizonalOffset = fHorizonalOffset;
	penMissile->m_fVerticalOffset = fVerticalOffset;
	penMissile->m_strHitEffect = szHitEffectName;
	penMissile->m_fAfterDelay = fWaitTime;
	penMissile->m_eMissileType = MLT_GOWAITBACK;
	penMissile->m_strMoveEffect = szMoveEffectName;

	penMissile->m_bNoPeak = FALSE;
	penMissile->Initialize();
	
	penMissile->m_bNormalHit = TRUE;
	penMissile->m_bCritical = bCritical;
	penMissile->m_ulTargetID = penMissile->en_ulID;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szMoveEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());
	}
}

void ShotConnect(CEntity *penShoter, CEntity *penTarget, FLOAT fWaitTime
				 , const char *szHitEffectName, const char *szConnectEffectName)
{
	//입력 조건 검사.
	ASSERT(penShoter != NULL && penShoter->en_pmiModelInstance != NULL);
	ASSERT(penTarget != NULL && penTarget->en_pmiModelInstance != NULL);
	ASSERT(szHitEffectName != NULL && szConnectEffectName != NULL);
	if(!(penShoter != NULL && penShoter->en_pmiModelInstance != NULL)) return;
	if(!(penTarget != NULL && penTarget->en_pmiModelInstance != NULL)) return;
	if(!(szHitEffectName != NULL && szConnectEffectName != NULL)) return;

	//missile 생성.
	CPlacement3D plNew;
	FLOAT3D vSourcePos = penShoter->GetPlacement().pl_PositionVector;
	plNew.pl_PositionVector = (vSourcePos + penTarget->GetPlacement().pl_PositionVector) * 0.5f;
	FLOAT3D vDir = vSourcePos - plNew.pl_PositionVector;
	FLOAT fLen = vDir.Length();
	vDir /= fLen;
	fLen *= 2;
	plNew.pl_OrientationAngle = GetEulerAngleFromDir(vDir);
	plNew.pl_PositionVector(2) += 1.0f;//이걸 안하면 바닥에 붙어서 이펙트가 나옴.

	CMissile *penMissile = (CMissile *)penShoter->en_pwoWorld->CreateEntity_t(plNew, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_epSource = penShoter;
	penMissile->m_epTarget = penTarget;	//target entity
	penMissile->m_strHitEffect = szHitEffectName;
	penMissile->m_fAfterDelay = fWaitTime;
	penMissile->m_eMissileType = MLT_CONNECT;
	penMissile->m_pMyEffectGroup = NULL;

	penMissile->Initialize();
	penMissile->m_pMyEffectGroup = NULL;

	penMissile->m_ulTargetID = penMissile->en_ulID;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szConnectEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());

		if(penMissile->m_pMyEffectGroup)
		{
			for(INDEX i=0; i<penMissile->m_pMyEffectGroup->GetEffectKeyVector().size(); ++i)
			{
				CEffect *pEffect = penMissile->m_pMyEffectGroup->GetEffectKeyVector()[i].m_pCreatedEffect;
				if(pEffect != NULL && pEffect->GetType() == ET_MDL)
				{
					FLOAT3D vNewStretch = ((CMdlEffect*)pEffect)->GetStretch();
					vNewStretch(2) = fLen;
					((CMdlEffect*)pEffect)->SetStretch(vNewStretch);
				}
			}
		}
	}
}


void CMissile::SetDefaultProperties(void) {
	m_bInit = FALSE ;
	m_eMissileType = MLT_NORMALARROW ;
	m_bEntityTarget = TRUE ;
	m_epTarget = NULL;
	m_epSource = NULL;
	m_vTargetPos = FLOAT3D(0 , 0 , 0);
	m_fMoveSpeed = 1.0f;
	m_fBeforeDelay = 0.0f;
	m_fAfterDelay = 3.5f;
	m_strHitEffect = "";
	m_strMoveEffect = "";
	m_fnModel = CTFILENAME("");
	m_fHorizonalOffset = 0.0f;
	m_fVerticalOffset = 0.0f;
	m_soSound.SetOwner(this);
	m_soSound.Stop(FALSE);
	m_bCritical = FALSE ;
	m_aAngleSpeed = 0.0f;
	m_bDirectTag = TRUE ;
	m_iFireObjectType = 0;
	CRationalEntity::SetDefaultProperties();
}

#line 452 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
void CMissile::RemakeSplinePath() 
#line 453 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 454 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(! m_bEntityTarget ){return ;}
#line 455 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bNoPeak )
#line 456 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 457 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . RemoveSample  (1);
#line 458 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 459 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 460 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 461 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . RemoveSample  (2);
#line 462 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 469 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vTargetPos  = m_epTarget  -> en_plPlacement  . pl_PositionVector ;
#line 470 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vTargetPos  (2) += m_vTargetCenterPos  (2);
#line 471 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (1.0f , vTargetPos );
#line 472 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . Prepare  ();
#line 473 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}

#line 475 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
void CMissile::InflictDirectDamage(CEntity * penToDamage,CEntity * penInflictor,enum DamageType dmtType,
#line 476 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fDamageAmmount,const FLOAT3D & vHitPoint,const FLOAT3D & vDirection) 
#line 477 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 478 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
int  nHitType  = 0;
#line 480 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_epSource  -> GetNetworkID  () == _pNetwork  -> MyCharacterInfo  . index )
#line 481 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 482 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
nHitType  = _pNetwork  -> MyCharacterInfo  . iHitEffectType ;
#line 483 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 485 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(nHitType  > 0)
#line 486 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 488 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
StartEffectGroup  (DEF_CAM_SHAKE  , _pTimer  -> CurrentTick  () , this  -> en_plPlacement  . pl_PositionVector  , FLOAT3D (0 , 0 , 0));
#line 489 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bCritical  = FALSE ;
#line 490 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 492 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bCritical )
#line 493 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 494 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
PlaySound  (m_soSound  , SOUND_BOW_CRITICAL  , SOF_3D  | SOF_VOLUMETRIC );
#line 495 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bCritical  = FALSE ;
#line 496 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 497 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 498 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 499 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
PlaySound  (m_soSound  , SOUND_BOW_BLOW  , SOF_3D  | SOF_VOLUMETRIC );
#line 500 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 502 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
fDamageAmmount  = 0;
#line 503 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(penToDamage )
#line 504 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 505 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(! (penToDamage  -> GetFlags  () & ENF_ALIVE )){return ;}
#line 506 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SE_Get_UIManagerPtr  () -> ShowDamage  (penToDamage  -> en_ulID );
#line 507 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
INDEX preHealth  , curHealth ;
#line 508 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
preHealth  = ((CUnit  *) penToDamage ) -> m_nPreHealth ;
#line 509 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
curHealth  = ((CUnit  *) penToDamage ) -> m_nCurrentHealth ;
#line 511 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(preHealth  != - 1 && curHealth  > preHealth )
#line 512 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 513 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
fDamageAmmount  = 1;
#line 514 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CUnit  *) penToDamage ) -> m_nCurrentHealth  = ((CUnit  *) penToDamage ) -> m_nPreHealth ;
#line 515 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 516 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 517 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 518 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
fDamageAmmount  = 0;
#line 519 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 521 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(penToDamage  == INFO  () -> GetTargetEntity  (eTARGET ))
#line 522 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 523 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(penToDamage  -> IsCharacter  ())
#line 524 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 525 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> UpdateTargetInfo  (((CUnit  *) penToDamage ) -> m_nMaxiHealth  , ((CUnit  *) penToDamage ) -> m_nCurrentHealth  , ((CCharacter  *) penToDamage ) -> m_nPkMode  , ((CCharacter  *) penToDamage ) -> m_nPkState  , ((CCharacter  *) penToDamage ) -> m_nLegit );
#line 526 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 527 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 528 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 529 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> UpdateTargetInfo  (((CUnit  *) penToDamage ) -> m_nMaxiHealth  , ((CUnit  *) penToDamage ) -> m_nCurrentHealth );
#line 530 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 531 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 533 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(penToDamage  -> IsEnemy  () && preHealth  >= 0)
#line 534 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 535 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
const INDEX iMobIndex  = ((CEnemy  *) penToDamage ) -> m_nMobDBIndex ;
#line 537 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(iMobIndex  == LORD_SYMBOL_INDEX )
#line 538 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 539 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CMobData  * MD  = CMobData  :: getData  (iMobIndex );
#line 540 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fMaxHealth  = ((CUnit  *) penToDamage ) -> m_nMaxiHealth ;
#line 542 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if((curHealth  <= fMaxHealth  * 0.25f))
#line 543 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 544 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(((CUnit  *) penToDamage ) -> m_nPlayActionNum  != 0)
#line 545 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 546 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> SetSkaModel  ("data\\npc\\Gguard\\sword04.smc");
#line 547 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> RefreshTagManager  ();
#line 548 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> StretchModel  (FLOAT3D (MD  -> GetScale  () , MD  -> GetScale  () , MD  -> GetScale  ()));
#line 549 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CUnit  *) penToDamage ) -> m_nPlayActionNum  = 0;
#line 550 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 551 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 552 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else if((curHealth  <= fMaxHealth  * 0.50f))
#line 553 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 554 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(((CUnit  *) penToDamage ) -> m_nPlayActionNum  != 1)
#line 555 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 556 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> SetSkaModel  ("data\\npc\\Gguard\\sword03.smc");
#line 557 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> RefreshTagManager  ();
#line 558 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> StretchModel  (FLOAT3D (MD  -> GetScale  () , MD  -> GetScale  () , MD  -> GetScale  ()));
#line 559 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CUnit  *) penToDamage ) -> m_nPlayActionNum  = 1;
#line 560 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 561 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 562 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else if((curHealth  <= fMaxHealth  * 0.75f))
#line 563 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 564 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(((CUnit  *) penToDamage ) -> m_nPlayActionNum  != 2)
#line 565 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 566 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> SetSkaModel  ("data\\npc\\Gguard\\sword02.smc");
#line 567 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> RefreshTagManager  ();
#line 568 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> StretchModel  (FLOAT3D (MD  -> GetScale  () , MD  -> GetScale  () , MD  -> GetScale  ()));
#line 569 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CUnit  *) penToDamage ) -> m_nPlayActionNum  = 2;
#line 570 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 571 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 572 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 573 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 574 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 579 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(_pNetwork  -> m_bSingleMode )
#line 580 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 583 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(g_slZone  == EXTREAM_SINGLEDUNGEON  && ! ((CEnemy  *) penToDamage ) -> m_bBoss )
#line 584 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 585 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CEntity  :: InflictDirectDamage  (penToDamage  , penInflictor  , DMT_EXPLOSION  , 30.0f , vHitPoint  , vDirection );
#line 586 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 587 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 588 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 589 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CEntity  :: InflictDirectDamage  (penToDamage  , penInflictor  , DMT_EXPLOSION  , fDamageAmmount  , vHitPoint  , vDirection );
#line 590 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 591 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 592 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 593 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 594 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CEntity  :: InflictDirectDamage  (penToDamage  , penInflictor  , dmtType  , fDamageAmmount  , vHitPoint  , vDirection );
#line 595 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 597 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(penToDamage  -> IsEnemy  ())
#line 598 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 599 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(((CUnit  *) ((CEntity  *) penToDamage )) -> m_nCurrentHealth  <= 0)
#line 600 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 601 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CMobData  * MD  = CMobData  :: getData  (((CEnemy  *) (CEntity  *) penToDamage ) -> m_nMobDBIndex );
#line 602 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(! MD  -> IsCastleTower  ())
#line 603 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 604 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CUnit  *) ((CEntity  *) penToDamage )) -> DeathNow  ();
#line 605 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 606 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 607 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 610 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(MD  -> GetMobIndex  () >= 352 && MD  -> GetMobIndex  () <= 399)
#line 611 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 612 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CUnit  *) ((CEntity  *) penToDamage )) -> DeathNow  ();
#line 613 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 614 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 615 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 616 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CUnit  *) ((CEntity  *) penToDamage )) -> SetFlagOff  (ENF_ALIVE );
#line 617 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 618 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 619 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 620 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 621 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else if(penToDamage )
#line 622 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 623 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(((CUnit  *) ((CEntity  *) penToDamage )) -> m_nCurrentHealth  <= 0)
#line 624 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 625 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CUnit  *) ((CEntity  *) penToDamage )) -> DeathNow  ();
#line 626 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 627 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 628 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}

#line 630 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
void CMissile::HitTarget() 
#line 631 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 632 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_iFireObjectType  == CSkill  :: MT_DASH )
#line 633 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 634 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_epSource  -> GetNetworkType  () == MSG_CHAR_PC  && 
#line 635 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epSource  -> GetNetworkID  () == _pNetwork  -> MyCharacterInfo  . index  && ! m_bMoveFail )
#line 636 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 637 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CPlacement3D plSource  = GetPlacement  ();
#line 639 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epSource  -> SetPlacement  (plSource );
#line 641 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
_pNetwork  -> SendSkillMessage  (401 , m_epTarget  , m_epTarget  -> GetNetworkID  () , TRUE  , 1);
#line 643 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 645 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bMoveFail )
#line 646 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 647 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epSource  -> SetPlacement  (GetPlacement  ());
#line 648 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 650 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATmatrix3D matrix ;
#line 651 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
MakeRotationMatrixFast  (matrix  , this  -> en_plPlacement  . pl_OrientationAngle );
#line 652 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vDir  (0 , 1 , 0);
#line 653 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
RotateVector  (vDir  , matrix );
#line 654 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vAxisY  (0 , 1 , 0);
#line 655 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT angle  = acos  (vDir  % vAxisY );
#line 656 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D axis  = vAxisY  * vDir ;
#line 657 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
axis  . Normalize  ();
#line 658 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATquat3D quat ;
#line 659 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
quat  . FromAxisAngle  (axis  , angle );
#line 660 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
StartEffectGroup  (m_strHitEffect  , _pTimer  -> GetLerpedCurrentTick  () , this  -> en_plPlacement  . pl_PositionVector  , quat );
#line 661 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 662 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else if((CEntity  *) m_epTarget  != NULL )
#line 663 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 664 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATmatrix3D matrix ;
#line 665 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
MakeRotationMatrixFast  (matrix  , this  -> en_plPlacement  . pl_OrientationAngle );
#line 666 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vDir  (0 , 1 , 0);
#line 667 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
RotateVector  (vDir  , matrix );
#line 668 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_dcEnemies  . Count  () > 0)
#line 669 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 670 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
DamagedTargetsInRange  (this  , m_dcEnemies  , DMT_EXPLOSION  , 1 , FLOAT3D (0 , 0 , 0) , TRUE );
#line 671 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 672 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 673 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 674 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
this  -> InflictDirectDamage  (m_epTarget  , this  , DMT_NONE  , 1 , this  -> en_plPlacement  . pl_PositionVector  , vDir );
#line 675 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 677 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vAxisY  (0 , 1 , 0);
#line 678 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT angle  = acos  (vDir  % vAxisY );
#line 679 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D axis  = vAxisY  * vDir ;
#line 680 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
axis  . Normalize  ();
#line 681 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATquat3D quat ;
#line 682 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
quat  . FromAxisAngle  (axis  , angle );
#line 683 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
StartEffectGroup  (m_strHitEffect  , _pTimer  -> GetLerpedCurrentTick  () , this  -> en_plPlacement  . pl_PositionVector  , quat );
#line 684 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 685 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 686 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 687 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vAxisY  (0 , 1 , 0);
#line 688 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vDir  = (m_vInitPos  - m_vTargetPos ) . SafeNormalize  ();
#line 689 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT angle  = acos  (vDir  % vAxisY );
#line 690 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D axis  = vAxisY  * vDir ;
#line 691 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATquat3D quat ;
#line 693 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_dcEnemies  . Count  () > 0)
#line 694 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 695 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
DamagedTargetsInRange  (this  , m_dcEnemies  , DMT_EXPLOSION  , 1 , FLOAT3D (0 , 0 , 0) , TRUE );
#line 696 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 698 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
quat  . FromAxisAngle  (axis  , angle );
#line 699 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
StartEffectGroup  (m_strHitEffect  , _pTimer  -> GetLerpedCurrentTick  () , this  -> en_plPlacement  . pl_PositionVector  , quat );
#line 700 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 701 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}

#line 702 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D CMissile::GetBoundingSphereInfo(CEntity * pen) 
#line 703 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 704 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pen  == NULL ){return FLOAT3D (1 , 0 , 1);}
#line 706 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pen  -> GetRenderType  () == RT_SKAMODEL  || pen  -> GetRenderType  () == RT_SKAEDITORMODEL )
#line 707 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 708 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pen  -> en_pmiModelInstance  != NULL )
#line 709 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 710 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATaabbox3D bbox ;
#line 711 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pen  -> en_pmiModelInstance  -> GetCurrentColisionBox  (bbox );
#line 712 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pen  -> en_pmiModelInstance  -> mi_vStretch ;
#line 713 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vLength  = bbox  . Max  () - bbox  . Min  ();
#line 714 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vLength  (2) = 0;
#line 715 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fStretchXY  = Max  (pen  -> en_pmiModelInstance  -> mi_vStretch  (1) , pen  -> en_pmiModelInstance  -> mi_vStretch  (3));
#line 716 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return FLOAT3D (vLength  . Length  () * 0.40f * fStretchXY  
#line 717 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, bbox  . Min  () (2) * pen  -> en_pmiModelInstance  -> mi_vStretch  (2) 
#line 718 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, bbox  . Max  () (2) * pen  -> en_pmiModelInstance  -> mi_vStretch  (2));
#line 719 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 720 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 721 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else if(pen  -> GetRenderType  () == RT_MODEL  || pen  -> GetRenderType  () == RT_EDITORMODEL )
#line 722 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 723 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pen  -> en_pmoModelObject  != NULL )
#line 724 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 725 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATaabbox3D bbox ;
#line 726 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pen  -> en_pmoModelObject  -> GetCurrentFrameBBox  (bbox );
#line 727 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vLength  = bbox  . Max  () - bbox  . Min  ();
#line 728 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vLength  (2) = 0;
#line 729 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return FLOAT3D (vLength  . Length  () * 0.40f , bbox  . Min  () (2) , bbox  . Max  () (2));
#line 730 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fStretchXY  = Max  (pen  -> en_pmoModelObject  -> mo_Stretch  (1) , pen  -> en_pmoModelObject  -> mo_Stretch  (3));
#line 731 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return FLOAT3D (vLength  . Length  () * 0.40f * fStretchXY  
#line 732 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, bbox  . Min  () (2) * pen  -> en_pmoModelObject  -> mo_Stretch  (2) 
#line 733 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, bbox  . Max  () (2) * pen  -> en_pmoModelObject  -> mo_Stretch  (2));
#line 734 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 735 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 736 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return FLOAT3D (1.0f , 0.0f , 1.0f);
#line 737 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}

#line 738 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
void CMissile::CalcPalacementOnPath(FLOAT curRatio,FLOAT oldRatio,FLOAT processedTime,CPlacement3D & newPlace) 
#line 739 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 740 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vCurrentPos  = GetSpline  () . Value  (curRatio );
#line 741 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vCurrentDir  = vCurrentPos  - GetSpline  () . Value  (oldRatio );
#line 743 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_iFireObjectType  == CSkill  :: MT_DASH )
#line 744 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 745 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fLeftDistance  += vCurrentDir  . Length  ();
#line 747 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vSource  = GetSpline  () . Value  (oldRatio );
#line 748 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vTarget  = vCurrentPos ;
#line 749 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CCastRay  crRay  (this  , vSource  , vTarget );
#line 750 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
crRay  . cr_ttHitModels  = CCastRay  :: TT_NONE ;
#line 751 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
crRay  . cr_bHitTranslucentPortals  = TRUE ;
#line 752 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
crRay  . cr_bPhysical  = TRUE ;
#line 753 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetWorld  () -> CastRay  (crRay );
#line 754 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(crRay  . cr_penHit  != NULL )
#line 755 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 756 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bMoveFail  = TRUE ;
#line 757 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 758 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 760 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
ANGLE3D aCurrentRot ;
#line 761 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_aAngleSpeed  != 0.0f)
#line 762 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 763 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATquat3D quatCurrent ;
#line 765 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
quatCurrent  . FromAxisAngle  (vCurrentDir  , RadAngle  (m_aAngleSpeed  * processedTime ));
#line 767 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
aCurrentRot  = GetEulerAngleFromQuaternion  (quatCurrent );
#line 768 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 769 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 770 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 771 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
aCurrentRot  = GetEulerAngleFromDir  (vCurrentDir );
#line 772 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 774 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
newPlace  . pl_OrientationAngle  = aCurrentRot ;
#line 775 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
newPlace  . pl_PositionVector  = vCurrentPos ;
#line 776 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}

#line 777 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
BOOL CMissile::PathMove(FLOAT fDeltaTime) 
#line 778 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 780 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
RemakeSplinePath  ();
#line 782 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CPlacement3D plNew ;
#line 783 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fOldRatio  = m_fRatio ;
#line 784 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fRatio  += m_fTimeRatio  * fDeltaTime ;
#line 785 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fTimeFromStart  += fDeltaTime ;
#line 786 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CalcPalacementOnPath  (m_fRatio  , fOldRatio  - m_fTimeRatio  * 0.001f , m_fTimeFromStart  , plNew );
#line 788 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_iFireObjectType  == CSkill  :: MT_DASH )
#line 789 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 798 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bMoveFail )
#line 799 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 800 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE ;
#line 801 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 804 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_fRatio  >= 0.8f)
#line 805 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 806 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 807 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE ;
#line 808 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 809 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 811 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 814 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_fRatio  >= 1.0f){return TRUE ;}
#line 815 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else {return FALSE ;}
#line 816 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
BOOL CMissile::
#line 818 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Main(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_Main
	ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::Main expects 'EVoid' as input!");	const EVoid &e = (const EVoid &)__eeInput;
#line 820 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bEntityTarget  && m_epTarget  . ep_pen  == NULL )
#line 821 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 822 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
InitAsVoid  ();
#line 823 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetFlagOff  (ENF_ALIVE );
#line 824 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetFlagOn  (ENF_CLIENTHANDLING );
#line 825 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 826 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 826 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE;
#line 827 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 828 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
InitAsSkaModel  ();
#line 829 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_soSound  . Set3DParameters  (30.0f , 5.0f , 1.0f , 1.0f);
#line 832 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
try {
#line 833 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_fnModel  . GetName  () != ""){SetSkaModel_t  (m_fnModel );}
#line 834 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 835 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 836 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fnModel  = CTFileName ("data\\effect\\ska\\invisible.smc");
#line 837 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetSkaModel_t  (m_fnModel );
#line 838 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 839 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_eMissileType  == MLT_NORMALARROW )
#line 840 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 841 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
en_pmiModelInstance  -> mi_qvOffset  . vPos  = FLOAT3D (0 , 0 , 0);
#line 842 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
en_pmiModelInstance  -> mi_qvOffset  . qRot  = FLOATquat3D (1 , 0 , 0 , 0);
#line 843 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 845 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 846 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
catch  (char  *)
#line 847 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 848 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
ASSERTALWAYS  ("Loading Fail.");
#line 849 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 852 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
ModelChangeNotify  ();
#line 853 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetPhysicsFlags  (EPF_MODEL_IMMATERIAL );
#line 854 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetCollisionFlags  (ECF_IMMATERIAL );
#line 856 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetFlags  (GetFlags  () & ~ ENF_CLUSTERSHADOWS );
#line 857 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(en_pmiModelInstance ){en_pmiModelInstance  -> SetCurrentColisionBoxIndex  (0);}
#line 859 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_eMissileType  == MLT_CONNECT )
#line 860 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 862 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_epSource  . ep_pen  == NULL )
#line 863 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 864 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetFlagOff  (ENF_ALIVE );
#line 865 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetFlagOn  (ENF_CLIENTHANDLING );
#line 866 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 867 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 867 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE;
#line 868 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 869 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fTimeFromStart  = 0.0f;
#line 871 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(GetModelInstance  ())
#line 872 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 873 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CSkaTag  tag ;
#line 874 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
tag  . SetName  ("__ROOT");
#line 875 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetModelInstance  () -> m_tmSkaTagManager  . Register  (& tag );
#line 876 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 878 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_Connect, TRUE, EVoid());return TRUE;
#line 879 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 880 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 881 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 884 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_iFireObjectType  == CSkill  :: MT_DASH )
#line 885 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 886 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_epSource  -> IsFlagOff  (ENF_INVISIBLE ))
#line 887 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 888 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epSource  -> SetFlagOn  (ENF_INVISIBLE );
#line 889 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 890 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 892 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bReached  = FALSE ;
#line 893 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bReached2  = FALSE ;
#line 894 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fRatio  = 0.0f;
#line 895 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fTimeFromStart  = 0.0f;
#line 896 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fLeftDistance  = 0.0f;
#line 897 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bMoveFail  = FALSE ;
#line 899 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(GetModelInstance  ())
#line 900 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 901 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CSkaTag  tag ;
#line 902 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
tag  . SetName  ("__ROOT");
#line 903 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetModelInstance  () -> m_tmSkaTagManager  . Register  (& tag );
#line 904 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 907 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fHorizonalOffset  = Clamp  (m_fHorizonalOffset  , - 1.0f , 1.0f);
#line 908 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fVerticalOffset  = Clamp  (m_fVerticalOffset  , - 1.0f , 1.0f);
#line 909 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_vInitPos  = en_plPlacement  . pl_PositionVector ;
#line 910 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bEntityTarget )
#line 911 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 912 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CTag  * pTag  = m_epTarget  -> GetModelInstance  () -> m_tmSkaTagManager  . Find  ("CENTER");
#line 913 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pTag )
#line 914 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 915 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_vTargetCenterPos  = pTag  -> GetOffsetPos  ();
#line 916 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
RotateVector  (m_vTargetCenterPos  , pTag  -> GetOffsetRot  ());
#line 917 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 918 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 919 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 920 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_vTargetCenterPos  = m_epTarget  -> en_plPlacement  . pl_PositionVector ;
#line 921 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 922 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 925 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vDist ;
#line 926 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bEntityTarget )
#line 927 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 928 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vDist  = m_epTarget  -> en_plPlacement  . pl_PositionVector  - this  -> en_plPlacement  . pl_PositionVector ;
#line 929 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 930 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 931 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 932 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vDist  = m_vTargetPos  - this  -> en_plPlacement  . pl_PositionVector ;
#line 933 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 934 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fDist  = vDist  . Length  ();
#line 935 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fTimeRatio  = m_fMoveSpeed  / fDist ;
#line 936 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
static FLOAT fNoPeakLimit  = 3.0f;
#line 937 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(! m_bNoPeak ){m_bNoPeak  = fDist  < fNoPeakLimit ;}
#line 938 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_pssPath  = new  cubic_spline ;
#line 939 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (0.0f , m_vInitPos );
#line 940 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(! m_bNoPeak )
#line 941 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 942 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vDist  *= 0.3f;
#line 943 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
static FLOAT fDistRatio  = 0.10f;
#line 944 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vDist  (2) += fDist  * fDistRatio  * (m_fVerticalOffset  * 0.5f + 0.5f);
#line 945 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_fHorizonalOffset  != 0.0f)
#line 946 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 947 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATquat3D qRot ;
#line 948 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
static FLOAT fAngle  = 15.0f;
#line 949 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
qRot  . FromEuler  (ANGLE3D (fAngle  * m_fHorizonalOffset  , 0 , 0));
#line 950 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vDist  = VectorRotate  (vDist  , qRot );
#line 951 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 952 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (0.4f , vDist  + this  -> en_plPlacement  . pl_PositionVector );
#line 953 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 954 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bEntityTarget )
#line 955 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 956 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
RemakeSplinePath  ();
#line 957 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 958 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 959 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 960 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (1.0f , m_vTargetPos );
#line 961 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . Prepare  ();
#line 962 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 964 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CPlacement3D plNew ;
#line 965 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fRatio  += m_fTimeRatio  * 0.001f;
#line 966 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CalcPalacementOnPath  (m_fRatio  , 0 , 0.001f , plNew );
#line 967 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 969 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_PreBehavior, TRUE, EVoid());return TRUE;
#line 970 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 972 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
delete  m_pssPath ;
#line 973 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_pssPath  = NULL ;
#line 974 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 975 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 975 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};BOOL CMissile::
#line 978 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
PreBehavior(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_PreBehavior
	ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::PreBehavior expects 'EVoid' as input!");	const EVoid &e = (const EVoid &)__eeInput;
#line 980 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetTimerAfter(0.01f);
Jump(STATE_CURRENT, 0x03ed0001, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0001_PreBehavior_01(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0001
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0002, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0002_PreBehavior_02(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0002
;
#line 981 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(! m_bInit )
#line 982 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 983 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fLastTime  = _pTimer  -> GetHighPrecisionTimer  () . GetSeconds  ();
#line 984 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bInit  = TRUE ;
#line 985 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 987 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_fBeforeDelay  <= _pTimer  -> TickQuantum ){m_fBeforeDelay  = _pTimer  -> TickQuantum  * 0.01f;}
#line 988 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetTimerAfter(m_fBeforeDelay );
Jump(STATE_CURRENT, 0x03ed0003, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0003_PreBehavior_03(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0003
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0004, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0004_PreBehavior_04(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0004
;
#line 990 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_DoBehavior, TRUE, EVoid());return TRUE;
#line 992 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 992 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};BOOL CMissile::
#line 994 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
PostBehavior(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_PostBehavior
	ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::PostBehavior expects 'EVoid' as input!");	const EVoid &e = (const EVoid &)__eeInput;
#line 996 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetTimerAfter(0.001f);
Jump(STATE_CURRENT, 0x03ed0006, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0006_PostBehavior_01(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0006
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0007, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0007_PostBehavior_02(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0007
;
#line 999 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_pMyEffectGroup  != NULL  && CEffectGroupManager  :: Instance  () . IsValidCreated  (m_pMyEffectGroup ))
#line 1000 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1001 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_pMyEffectGroup  -> Stop  (0);
#line 1002 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1003 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else m_pMyEffectGroup  = NULL ;
#line 1006 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_epTarget  . ep_pen  != NULL  && m_epTarget  -> en_pmiModelInstance  != NULL )
#line 1007 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1008 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_eMissileType  == MLT_NORMALARROW  
#line 1009 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
&& ((CEnemy  *) (CEntity  *) m_epTarget ) -> m_nMobDBIndex  != 82)
#line 1010 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1012 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CSkaTag  * pSkaTag  = NULL ;
#line 1013 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
INDEX temp  = m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . GetTempValue  ();
#line 1014 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
for(m_iIndex  = 0;m_iIndex  < 31;++ m_iIndex ){if(! (temp  & (0x00000001 << m_iIndex ))){break ;}}
#line 1015 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_iIndex  != 31)
#line 1016 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1017 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_strHitTag  . PrintF  ("TEMP%x" , 0x00000001 << m_iIndex );
#line 1018 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . SetTempValue  (temp  | (0x00000001 << m_iIndex ));
#line 1019 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pSkaTag  = (CSkaTag  *) m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . Find  (m_strHitTag  . str_String );
#line 1020 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pSkaTag  == NULL )
#line 1021 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1028 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vTarget  = m_epTarget  -> en_plPlacement  . pl_PositionVector ;
#line 1029 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vTarget  (2) += m_vTargetCenterPos  (2);
#line 1030 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vDist  = vTarget  - m_vInitPos ;
#line 1031 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT dist  = vDist  . Length  ();
#line 1032 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
INDEX iBoneID ;
#line 1033 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
MeshLOD  * pmlod  = NULL ;
#line 1034 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pSkaTag  = new  CSkaTag ;
#line 1035 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fDist  = RM_TestRayCastHit  (
#line 1036 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
* m_epTarget  -> en_pmiModelInstance  
#line 1037 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, m_epTarget  -> en_mRotation  
#line 1038 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, m_epTarget  -> en_plPlacement  . pl_PositionVector  
#line 1039 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, m_vInitPos  
#line 1040 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, vTarget  
#line 1041 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, dist  
#line 1042 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, & iBoneID  
#line 1043 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, pSkaTag );
#line 1044 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(fDist  == 1e6)
#line 1045 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1046 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
delete  pSkaTag ;
#line 1047 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pSkaTag  = NULL ;
#line 1048 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1049 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else 
#line 1050 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1051 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pSkaTag  -> SetName  (m_strHitTag  . str_String );
#line 1052 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOATquat3D quatDir  , quatEn  , quatEnMi ;
#line 1053 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
quatEn  . FromEuler  (m_epTarget  -> en_plPlacement  . pl_OrientationAngle );
#line 1054 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
quatEnMi  = quatEn  . Inv  () * m_epTarget  -> en_pmiModelInstance  -> mi_qvOffset  . qRot  . Inv  ();
#line 1055 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
quatDir  . FromEuler  (GetEulerAngleFromDir  (vDist  . SafeNormalize  ()));
#line 1057 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pSkaTag  -> SetOffsetRot  (quatEnMi  * quatDir );
#line 1059 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D pos  = pSkaTag  -> GetOffsetPos  () - m_epTarget  -> en_plPlacement  . pl_PositionVector  - m_epTarget  -> en_pmiModelInstance  -> mi_qvOffset  . vPos ;
#line 1060 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pos  = VectorRotate  (pos  , quatEnMi );
#line 1061 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
pSkaTag  -> SetOffsetPos  (pos );
#line 1063 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . RegisterNoCopy  (pSkaTag );
#line 1064 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1065 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1066 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1067 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pSkaTag  != NULL )
#line 1068 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1069 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CEffectGroup  * pEG  = StartEffectGroup  (
#line 1070 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
"Normal Arrow" 
#line 1071 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, _pTimer  -> GetLerpedCurrentTick  () 
#line 1072 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
, ptr_tag  ((CTag  *) pSkaTag ));
#line 1073 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pEG ){pEG  -> Stop  (m_fAfterDelay );}
#line 1074 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
this  -> SetFlagOn  (ENF_HIDDEN );
#line 1075 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1076 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1077 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
else if(m_eMissileType  == MLT_GOWAITBACK )
#line 1078 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1079 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1080 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1082 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_fAfterDelay  <= _pTimer  -> TickQuantum ){m_fAfterDelay  = _pTimer  -> TickQuantum  * 0.01f;}
#line 1083 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetTimerAfter(m_fAfterDelay );
Jump(STATE_CURRENT, 0x03ed0008, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0008_PostBehavior_03(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0008
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0009, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0009_PostBehavior_04(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0009
;
#line 1085 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_eMissileType  == MLT_GOWAITBACK  && m_epSource  != NULL  && m_epSource  -> en_pmiModelInstance  != NULL )
#line 1086 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1087 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bReached  = FALSE ;
#line 1088 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bReached2  = FALSE ;
#line 1089 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fRatio  = 0.0f;
#line 1090 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fTimeFromStart  = 0.0f;
#line 1091 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bNoPeak  = TRUE ;
#line 1092 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_eMissileType  = MLT_SOMETHING ;
#line 1093 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fAfterDelay  = 0.0f;
#line 1094 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_strHitEffect  += "\'";
#line 1096 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_vInitPos  = m_epTarget  -> GetPlacement  () . pl_PositionVector ;
#line 1097 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vDist  = m_vInitPos  - m_epSource  -> GetPlacement  () . pl_PositionVector ;
#line 1098 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fDist  = vDist  . Length  ();
#line 1099 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fTimeRatio  = m_fMoveSpeed  / fDist ;
#line 1100 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . Clear  ();
#line 1101 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (0.0f , m_vInitPos );
#line 1102 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (1.0f , m_epSource  -> GetPlacement  () . pl_PositionVector );
#line 1103 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epTarget  = m_epSource ;
#line 1104 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
GetSpline  () . Prepare  ();
#line 1105 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
RemakeSplinePath  ();
#line 1106 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CPlacement3D plNew ;
#line 1107 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fRatio  += m_fTimeRatio  * 0.001f;
#line 1108 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CalcPalacementOnPath  (m_fRatio  , 0 , 0.001f , plNew );
#line 1109 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 1110 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_strMoveEffect  += "\'";
#line 1111 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_pMyEffectGroup  = StartEffectGroup  (m_strMoveEffect  , & GetModelInstance  () -> m_tmSkaTagManager  , _pTimer  -> GetLerpedCurrentTick  ());
#line 1112 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bInit  = FALSE ;
#line 1113 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_PreBehavior, TRUE, EVoid());return TRUE;
#line 1114 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1116 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
this  -> SetFlagOn  (ENF_HIDDEN );
#line 1117 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_strHitTag  != "" && m_epTarget  -> en_RenderType  != RT_NONE  && m_epTarget  -> en_pmiModelInstance )
#line 1118 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1119 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . Unregister  (m_strHitTag  . str_String );
#line 1120 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . SetTempValue  (
#line 1121 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . GetTempValue  () & 
#line 1122 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
(~ (0x00000001 << m_iIndex )));
#line 1123 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1125 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_epSource  != NULL )
#line 1126 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1127 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_epSource  -> GetNetworkID  () == _pNetwork  -> MyCharacterInfo  . index )
#line 1128 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1129 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_epSource  -> IsFlagOn  (ENF_INVISIBLE ))
#line 1130 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1131 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_epSource  -> SetFlagOff  (ENF_INVISIBLE );
#line 1132 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1133 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1134 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1136 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bInit  = FALSE ;
#line 1137 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetFlagOff  (ENF_ALIVE );
#line 1138 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetFlagOn  (ENF_CLIENTHANDLING );
#line 1139 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
delete  m_pssPath ;
#line 1140 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_pssPath  = NULL ;
#line 1141 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 1143 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 1143 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};BOOL CMissile::
#line 1145 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
DoBehavior(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_DoBehavior
	ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::DoBehavior expects 'EVoid' as input!");	const EVoid &e = (const EVoid &)__eeInput;
#line 1147 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Jump(STATE_CURRENT,0x03ed000d, FALSE, EInternal());return TRUE;}BOOL CMissile::H0x03ed000d_DoBehavior_03(const CEntityEvent &__eeInput)
#line 1148 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed000d
if(!(! m_bReached )){ Jump(STATE_CURRENT,0x03ed000e, FALSE, EInternal());return TRUE;}
#line 1149 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetTimerAfter(0.01f);
Jump(STATE_CURRENT, 0x03ed000b, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed000b_DoBehavior_01(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed000b
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed000c, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed000c_DoBehavior_02(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed000c
;
#line 1150 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_bEntityTarget  && m_epTarget  . ep_pen  == NULL )
#line 1151 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1152 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_PostBehavior, TRUE, EVoid());return TRUE;
#line 1153 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1155 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fCurrent  = _pTimer  -> GetHighPrecisionTimer  () . GetSeconds  ();
#line 1156 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fDeltaTime  = fCurrent  - m_fLastTime ;
#line 1157 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fLastTime  = fCurrent ;
#line 1159 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(! m_bReached )
#line 1160 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1161 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_bReached  = PathMove  (m_fDeltaTime );
#line 1162 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}Jump(STATE_CURRENT,0x03ed000d, FALSE, EInternal());return TRUE;
#line 1167 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}BOOL CMissile::H0x03ed000e_DoBehavior_04(const CEntityEvent &__eeInput) {
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed000e

#line 1169 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
HitTarget  ();
#line 1171 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_PostBehavior, TRUE, EVoid());return TRUE;
#line 1173 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 1173 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};BOOL CMissile::
#line 1175 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Connect(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_Connect
	ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::Connect expects 'EVoid' as input!");	const EVoid &e = (const EVoid &)__eeInput;
#line 1177 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetTimerAfter(0.1f);
Jump(STATE_CURRENT, 0x03ed0010, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0010_Connect_01(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0010
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0011, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0011_Connect_02(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0011
;
#line 1179 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
m_fLastTime  = _pTimer  -> GetLerpedCurrentTick  ();
#line 1180 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
StartEffectGroup  (m_strHitEffect  , & m_epTarget  -> GetModelInstance  () -> m_tmSkaTagManager  , m_fLastTime );
#line 1182 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetTimerAfter(0.1f);
Jump(STATE_CURRENT, 0x03ed0012, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0012_Connect_03(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0012
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0013, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0013_Connect_04(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0013
;
#line 1183 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Jump(STATE_CURRENT,0x03ed0016, FALSE, EInternal());return TRUE;}BOOL CMissile::H0x03ed0016_Connect_07(const CEntityEvent &__eeInput)
#line 1184 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0016
if(!(_pTimer  -> GetLerpedCurrentTick  () - m_fLastTime  < m_fAfterDelay )){ Jump(STATE_CURRENT,0x03ed0017, FALSE, EInternal());return TRUE;}
#line 1185 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CPlacement3D plNew ;
#line 1186 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vSourcePos  = m_epSource  -> GetPlacement  () . pl_PositionVector ;
#line 1187 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
plNew  . pl_PositionVector  = (vSourcePos  + m_epTarget  -> GetPlacement  () . pl_PositionVector ) * 0.5f;
#line 1188 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vDir  = vSourcePos  - plNew  . pl_PositionVector ;
#line 1189 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT fLen  = vDir  . Length  ();
#line 1190 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vDir  /= fLen ;
#line 1191 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
fLen  *= 2;
#line 1192 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
plNew  . pl_OrientationAngle  = GetEulerAngleFromDir  (vDir );
#line 1193 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
plNew  . pl_PositionVector  (2) += 1.0f;
#line 1194 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 1196 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_pMyEffectGroup )
#line 1197 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1198 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
for(INDEX i  = 0;i  < m_pMyEffectGroup  -> GetEffectKeyVector  () . size  ();++ i )
#line 1199 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1200 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
CEffect  * pEffect  = m_pMyEffectGroup  -> GetEffectKeyVector  () [ i  ] . m_pCreatedEffect ;
#line 1201 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(pEffect  != NULL  && pEffect  -> GetType  () == ET_MDL )
#line 1202 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1203 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
FLOAT3D vNewStretch  = ((CMdlEffect  *) pEffect ) -> GetStretch  ();
#line 1204 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
vNewStretch  (2) = fLen ;
#line 1205 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
((CMdlEffect  *) pEffect ) -> SetStretch  (vNewStretch );
#line 1206 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1207 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1208 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1210 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
SetTimerAfter(0.1f);
Jump(STATE_CURRENT, 0x03ed0014, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0014_Connect_05(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0014
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0015, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0015_Connect_06(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0015
;Jump(STATE_CURRENT,0x03ed0016, FALSE, EInternal());return TRUE;
#line 1211 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}BOOL CMissile::H0x03ed0017_Connect_08(const CEntityEvent &__eeInput) {
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0017

#line 1213 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
if(m_pMyEffectGroup )
#line 1214 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
{
#line 1215 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
StopEffectGroupIfValid  (m_pMyEffectGroup  , 0.1f);
#line 1216 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
}
#line 1217 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 1218 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 1218 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};