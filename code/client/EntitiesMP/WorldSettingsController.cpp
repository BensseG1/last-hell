/*
 * This file is generated by Entity Class Compiler, (c) CroTeam 1997-98
 */

#line 2 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"

#include "StdH.h"
#include "EntitiesMP/EnvironmentParticlesHolder.h"

#include <WorldSettingsController.h>
#include <WorldSettingsController_tables.h>
void CWorldSettingsController::SetDefaultProperties(void) {
	m_tmStormStart = -1.0f;
	m_strName = "World settings controller";
	m_tmLightningStart = -1.0f;
	m_fLightningPower = 1.0f;
	m_tmStormEnd = -1.0f;
	m_tmPyramidPlatesStart = 1e6;
	m_tmActivatedPlate1 = 1e6;
	m_tmDeactivatedPlate1 = 1e6;
	m_tmActivatedPlate2 = 1e6;
	m_tmDeactivatedPlate2 = 1e6;
	m_tmActivatedPlate3 = 1e6;
	m_tmDeactivatedPlate3 = 1e6;
	m_tmActivatedPlate4 = 1e6;
	m_tmDeactivatedPlate4 = 1e6;
	m_tmPyramidMorphRoomActivated = 1e6;
	m_tmShakeStarted = -1.0f;
	m_vShakePos = FLOAT3D(0 , 0 , 0);
	m_fShakeFalloff = 100.0f;
	m_fShakeFade = 1.0f;
	m_fShakeIntensityY = 1.0f;
	m_tmShakeFrequencyY = 1.0f;
	m_fShakeIntensityB = 1.0f;
	m_tmShakeFrequencyB = 1.0f;
	m_fShakeIntensityZ = 1.0f;
	m_tmShakeFrequencyZ = 1.0f;
	m_bShakeFadeIn = FALSE ;
	m_penEnvPartHolder = NULL;
	m_bNoSaveGame = FALSE ;
	m_tmGlaringStarted = -1.0f;
	m_tmGlaringEnded = -1.0f;
	m_fGlaringFadeInRatio = 0.1f;
	m_fGlaringFadeOutRatio = 0.1f;
	m_colGlade = COLOR(C_WHITE  | CT_TRANSPARENT );
	m_colBlendStart = COLOR(C_WHITE  | CT_TRANSPARENT );
	m_colBlendStop = COLOR(C_WHITE  | CT_OPAQUE );
	m_colShadeStart = COLOR(C_WHITE  | CT_OPAQUE );
	m_colShadeStop = COLOR(C_GRAY  | CT_OPAQUE );
	m_bApplyShadingToModels = FALSE ;
	m_tmStormAppearTime = 10.0f;
	m_tmStormDisappearTime = 10.0f;
	m_penHudPicFXHolder = NULL;
	CEntity::SetDefaultProperties();
}

#line 76 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
BOOL CWorldSettingsController::IsTargetValid(SLONG slPropertyOffset,CEntity * penTarget) 
#line 77 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 78 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
if(slPropertyOffset  == offsetof  (CWorldSettingsController  , m_penEnvPartHolder )){
#line 79 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
return IsOfClass  (penTarget  , & CEnvironmentParticlesHolder_DLLClass );
#line 80 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 81 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
return CEntity  :: IsTargetValid  (slPropertyOffset  , penTarget );
#line 82 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}

#line 84 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
FLOAT CWorldSettingsController::GetStormFactor(void) 
#line 85 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 86 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
FLOAT fStormFactor  = 0.0f;
#line 87 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
TIME  tmNow  = _pTimer  -> GetLerpedCurrentTick  ();
#line 89 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
if(tmNow  > m_tmStormStart  && tmNow  < m_tmStormEnd  + m_tmStormDisappearTime )
#line 90 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 92 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
if(tmNow  > m_tmStormStart  + m_tmStormAppearTime  && tmNow  < m_tmStormEnd )
#line 93 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 94 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
fStormFactor  = 1.0f;
#line 95 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 97 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
else if(tmNow  > m_tmStormEnd )
#line 98 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 99 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
fStormFactor  = 1.0f - (tmNow  - m_tmStormEnd ) / m_tmStormDisappearTime ;
#line 100 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 102 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
else 
#line 103 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 104 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
fStormFactor  = (tmNow  - m_tmStormStart ) / m_tmStormAppearTime ;
#line 105 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 106 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 107 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
return fStormFactor ;
#line 108 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}

#line 111 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
BOOL CWorldSettingsController::HandleEvent(const CEntityEvent & ee) 
#line 112 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 147 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
if(ee  . ee_slEvent  == EVENTCODE_EHudPicFX )
#line 148 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 149 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
EHudPicFX  ehpfx  = ((EHudPicFX  &) ee );
#line 150 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
if(ehpfx  . bStart )
#line 151 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 152 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
m_penHudPicFXHolder  = ehpfx  . penSender ;
#line 153 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 154 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
else 
#line 155 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 156 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
if(m_penHudPicFXHolder  == ehpfx  . penSender )
#line 157 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
{
#line 158 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
m_penHudPicFXHolder  = NULL ;
#line 159 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 160 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 161 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
return TRUE ;
#line 162 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
#line 181 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
return FALSE ;
#line 182 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
}
BOOL CWorldSettingsController::
#line 185 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
Main(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CWorldSettingsController_Main
	ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CWorldSettingsController::Main expects 'EVoid' as input!");	const EVoid &e = (const EVoid &)__eeInput;
#line 191 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
InitAsEditorModel  ();
#line 192 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
SetPhysicsFlags  (EPF_MODEL_IMMATERIAL );
#line 193 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
SetCollisionFlags  (ECF_IMMATERIAL );
#line 196 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
SetModel  (MODEL_WORLD_SETTINGS_CONTROLLER );
#line 197 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
SetModelMainTexture  (TEXTURE_WORLD_SETTINGS_CONTROLLER );
#line 199 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
m_tmStormStart  = 1e5 - 1.0f;
#line 200 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
m_tmStormEnd  = 1e5;
#line 203 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
Return(STATE_CURRENT,EVoid());
#line 203 "F:/SD-Source/mandra/Reco_Csrc/EntitiesMP/WorldSettingsController.es"
return TRUE; ASSERT(FALSE); return TRUE;};